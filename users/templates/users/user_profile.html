{% extends 'main/base.html' %}

{% block content %}
  <div class="container mt-4">
    <div class="profile-header d-flex justify-content-between align-items-center border-bottom pb-3">
      <div class="d-flex align-items-center">
        <img src="{{ profile.avatar_thumbnail.url }}" alt="Avatar" class="rounded-circle border" style="width: 100px; height: 100px;" />
        <div class="profile-info ms-3">
          <h3>{{ profile.display_name }}</h3>
          <p class="text-muted">Joined: {{ user.date_joined|date:'d M, Y' }}</p>
        </div>
      </div>
      <div class="profile-stats text-end">
        <p class="mb-1">
          <strong>Đã bình luận:</strong> {{ user.total_comments }}
        </p>
        <p class="mb-1">
          <strong>Lượt reaction:</strong> {{ user.reaction_score }}
        </p>
      </div>
    </div>
    <div class="profile-actions mt-3 text-end">
      {% if request.user != user %}
        <form method="POST" action="">
          {% csrf_token %}
          {% if request.user in followers %}
            <button type="submit" class="btn btn-secondary">Unfollow</button>
          {% else %}
            <button type="submit" class="btn btn-primary">Follow</button>
          {% endif %}
        </form>
      {% endif %}
    </div>

    <ul class="nav nav-pills mt-4" id="profileTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="true">Profile</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="threads-tab" data-bs-toggle="tab" data-bs-target="#threads" type="button" role="tab" aria-controls="threads" aria-selected="false">Postings</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab" aria-controls="about" aria-selected="false">About</button>
      </li>
    </ul>
    <div class="tab-content mt-3" id="profileTabContent">
      <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        <!-- Profile content -->
        <p>{{ profile.bio }}</p>
      </div>

      <div class="tab-pane fade" id="threads" role="tabpanel" aria-labelledby="threads-tab">
        <!-- Threads content -->
        <ul class="list-unstyled">
          {% for thread in threads %}
            <li class="border-bottom py-2">
              <a href="{% url 'main:thread_detail' thread.slug %}" class="text-decoration-none">{{ thread.title }}</a>
              <br />
              <small class="text-muted">Posted on {{ thread.created_at|date:'d M, Y' }}</small>
            </li>
          {% endfor %}
        </ul>
      </div>

      <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
        <!-- About content -->
        <ul class="list-unstyled">
          <li class="border-bottom py-2">
            <p>
              <strong>Followers:</strong>
            </p>
            <ul class="list-unstyled">
              {% for follow in followers %}
                <li>
                  <a href="{% url 'users:user_profile' follow.username %}" class="text-decoration-none">{{ follow.username }}</a>
                </li>
              {% endfor %}
            </ul>
          </li>
          <li class="border-bottom py-2">
            <p>
              <strong>Following:</strong>
            </p>
            <ul class="list-unstyled">
              {% for follow in following %}
                <li>
                  <a href="{% url 'users:user_profile' follow.username %}" class="text-decoration-none">{{ follow.username }}</a>
                </li>
              {% endfor %}
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
{% endblock %}
